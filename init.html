<!-- Nova Kukla | Events Calander -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>

  <!-- cute font (close to halau) -->
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    /* ====== root variables | brand palette ====== */
    :root
    {
      --brand-pink: #ef779f;
      --brand-blue: #36a8de;
      --brand-green: #3db489;
      --brand-yellow: #f8c964;
      --brand-orange: #f47948;
    }
    /* -------------------------------------------- */

    /* =============== base layout styles =============== */
    body
    {
      margin: 0;
      padding: 0;
      background: transparent;
      font-family: 'Baloo 2', sans-serif;
      font-size: large;
      color: #333;
    }

    /* Prevent page overflow/scrollbars, but allow the calendar to manage its own scrolling */
    html, body
    {
      height: 100%;
      overflow: hidden;
      -ms-overflow-style: none; /* IE/Edge legacy */
      scrollbar-width: none; /* Firefox */
    }

    html::-webkit-scrollbar,
    body::-webkit-scrollbar,
    .fc-scroller::-webkit-scrollbar
    {
      width: 0;
      height: 0;
      display: none;
    }

    .fc-scroller
    {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }

    #fr-events-calendar { max-width: 100%; margin: 0 auto; height: 100vh; }

    html,
    body,
    #fr-events-calendar{ height: 100%; }

    /* Debug is off by default (public-facing) */
    #fr-debug { display: none; }
    .fr-debug-enabled #fr-debug { display: block; }
    /* --------------------------------------------------- */

    /* ======= styles for day cells / grid ======= */
    .fc-daygrid-day-frame
    {
      min-height: 130px; /* event frame height */
      background-color: #fffdf7;
      border: none;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,0.05);
      border-radius: 8px;
      padding: 2px;
    }

    .fc-scrollgrid
    {
      border: none;
    }

    .fc-daygrid-day-number
    {
      font-weight: 600;
      color: var(--brand-green);
      margin: 2px;
    }
    /* -------------------------------------------- */

    /* ====== styles for events in the grid ====== */
    .fc-daygrid-day-events
    {
      max-height: none !important;
    }

    .fc-daygrid-event-harness
    {
      height: auto !important;
      margin-bottom: 4px;
    }

    .fc-daygrid-event
    {
      height: auto !important;
      white-space: normal;
      padding: 0;
      overflow: hidden;
      border-radius: 12px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }

    .fc-daygrid-event:hover
    {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }

    .fc-daygrid-day-events,
    .fc-daygrid-event-harness,
    .fc-daygrid-event
    {
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
      margin: 0;
    }
    /* ------------------------------------------ */

    /* == styles for event card content == */
    .fr-event-card
    {
      display: flex;
      flex-direction: column;
      font-size: 11px;
      color: #fff;
      width: 100%;
      box-sizing: border-box;
      min-height: 200px; /* adjust */
    }

    .fr-event-card img
    {
      width: 100%;
      height: 150px; /* adjust */
      object-fit: cover;
      display: block;
    }

    .fr-event-title
    {
      padding: 6px;
      font-weight: 600;
      font-size: 15px; /* adjust */
    }

    .fr-event-time
    {
      padding: 0 6px 6px;
      font-size: 12px;
      opacity: 0.9;
    }
    /* ---------------------------------- */

    /* ================== styles for highlighting today ================== */
    .fc-day-today .fc-daygrid-day-frame
    {
      background: linear-gradient(135deg, rgba(248,201,100,0.35), #fffdf7);
      box-shadow:
        0 0 0 2px rgba(248,201,100,0.9),
        inset 0 0 0 1px rgba(0,0,0,0.06);
    }

    .fc-day-today .fc-daygrid-day-number
    {
      color: var(--brand-pink);
      font-weight: 700;
    }
    /* ------------------------------------------------------------------- */

    /* ========== mobile styles: thumbnail-only cards ========== */
    @media (max-width: 600px)
    {
      .fc-daygrid-day-frame { min-height: auto; padding: 2px; }

      .fc-daygrid-day-events { max-height: none !important; }

      .fc-daygrid-event-harness { height: auto !important; }

      .fc-daygrid-event { height: auto !important; }

      .fr-event-title, .fr-event-time { display: none; }

      .fr-event-card
      {
        aspect-ratio: 1 / 1;
        padding: 0;
        min-height: 0;
      }

      .fr-event-card img
      {
        width: 100%;
        height: 100%;
        max-height: none;
        object-fit: cover;
        display: block;
      }
    }
    /* ------------------------------------------------------ */
  </style>
</head>

<body>
  <div id="fr-events-calendar"></div>
  <div id="fr-debug" style="font-size:12px;padding:6px 8px;color:#333;"></div>

  <script>
    // ============== data loading and calendar setup ==============
    document.addEventListener('DOMContentLoaded', async function ()
    {
      const calendarEl = document.getElementById('fr-events-calendar');
      const debugEl = document.getElementById('fr-debug');

      const urlParams = new URLSearchParams(window.location.search);
      const debugEnabled = urlParams.get('debug') === '1';
      if (debugEnabled)
      {
        document.documentElement.classList.add('fr-debug-enabled');
      }

      function setDebug(msg, isError = false)
      {
        if (!debugEnabled || !debugEl) return;
        debugEl.textContent = msg;
        debugEl.style.color = isError ? '#b00020' : '#333';
      }

      const eventsOverride = urlParams.get('events');

      const sameDirEventsUrl = window.location.protocol === 'file:'
        ? null
        : new URL('events.json', window.location.href).toString();

      // Fallback: hardcoded raw GitHub URL for this repo.
      const defaultEventsUrl = 'https://raw.githubusercontent.com/Novakukla/FloridaRAMA-Calendar/refs/heads/main/events.json';

      const candidateEventUrls = [eventsOverride, sameDirEventsUrl, defaultEventsUrl].filter(Boolean);
      const uniqueCandidateEventUrls = [...new Set(candidateEventUrls)];

      // array for events loaded from json
      let events = [];
      let loadedFrom = null;
      for (const candidateUrl of uniqueCandidateEventUrls)
      {
        try
        {
          const res = await fetch(candidateUrl, { cache: 'no-store' });
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          events = await res.json();
          loadedFrom = candidateUrl;
          break;
        }
        catch (err)
        {
          console.warn(`Failed to load events.json from ${candidateUrl}`, err);
        }
      }

      if (!loadedFrom)
      {
        console.error('Error loading events.json (all sources failed)', { tried: uniqueCandidateEventUrls });
        setDebug(`Failed to load events.json. Tried: ${uniqueCandidateEventUrls.join(' | ')}`, true);
      }
      else
      {
        setDebug(`Loaded ${events.length} event(s) from ${loadedFrom}`);
      }

      // create calendar instance
      const calendar = new FullCalendar.Calendar(calendarEl,
      {
        initialView: 'dayGridMonth',
        height: '100%',
        events: events,

        // open fareharbor or detail url in new tab
        eventClick: function (info)
        {
          if (info.event.url)
          {
            window.open(info.event.url, '_blank');
            info.jsEvent.preventDefault();
          }
        },

        // ===================== custom rendering for event cards =====================
        eventContent: function (info)
        {
          const props = info.event.extendedProps;
          const thumbnail = props.thumbnail;
          const title = info.event.title;

          // build color palette from css custom properties
          const palette =
          [
            getComputedStyle(document.documentElement).getPropertyValue('--brand-pink').trim(),
            getComputedStyle(document.documentElement).getPropertyValue('--brand-blue').trim(),
            getComputedStyle(document.documentElement).getPropertyValue('--brand-green').trim(),
            getComputedStyle(document.documentElement).getPropertyValue('--brand-yellow').trim(),
            getComputedStyle(document.documentElement).getPropertyValue('--brand-orange').trim()
          ];

          // pick random brand color for this card
          const color = palette[Math.floor(Math.random() * palette.length)];

          // create card container
          const container = document.createElement('div');
          container.className = 'fr-event-card';
          container.style.background =
            `linear-gradient(135deg, ${color} 0%, ${color} 80%, rgba(255,255,255,0.15) 100%)`;

          // add thumbnail if present
          if (thumbnail)
          {
            const img = document.createElement('img');
            img.src = thumbnail;
            img.alt = title;
            container.appendChild(img);
          }

          // add title text
          const titleEl = document.createElement('div');
          titleEl.className = 'fr-event-title';
          titleEl.textContent = title;
          container.appendChild(titleEl);

          // return dom nodes for fullcalendar to render
          return { domNodes: [container] };
        }
        // ----------------------------------------------------------------------------
      });

      // render calendar into dom
      calendar.render();
    });
    // -------------------------------------------------------------
  </script>
</body>
</html>
